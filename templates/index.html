{% extends "base.html" %}
{% block content %}
<div class="trusturl-card">
    <div class="trusturl-description">
        Protect yourself from phishing attacks with the help of AI-powered detection. Surf safe with TrustURL.
    </div>

    <form action="/" method="post" class="trusturl-urlform">
        <input 
            type="text" 
            name="url" 
            placeholder="Paste or enter URL (e.g. https://example.com)" 
            value="{{ request.form.url or '' }}"
            autocomplete="off"
            class="trusturl-urlinput"
            required
        />
        <button type="submit" class="trusturl-action-btn trusturl-form-btn">Check URL</button>
    </form>

    {% if output != "NA" %}
    <h2 class="trusturl-results-header">Results</h2>

    <div class="trusturl-results">
        <div class="trusturl-score-wrap">
            <span class="trusturl-score-label">Trust Score:</span>
            <span class="trusturl-score-value">
                {{ output.trust_score if output.trust_score is defined else "85" }} / 100
            </span>
        </div>
        <span class="trusturl-safe-status">
            {% if output.res is defined and output.res == "Phishing" %}
                <span style="color:#ff6f7a;">Phishing</span>
            {% else %}
                Safe
            {% endif %}
        </span>
        <span class="trusturl-url">{{ output.url if output.url is defined else "https://example.com" }}</span>

        <div class="trusturl-btn-row">
            <form action="{{ url_for('preview') }}" method="POST" target="_blank" style="display:inline;">
                <input type="hidden" name="url" value="{{output.url}}">
                <button type="submit" class="trusturl-action-btn">Preview</button>
            </form>
            <form action="{{ url_for('view_source_code') }}" method="POST" target="_blank" style="display:inline;">
                <input type="hidden" name="url" value="{{output.url}}">
                <button type="submit" class="trusturl-action-btn">View Source Code</button>
            </form>
        </div>

        <table class="trusturl-table">
            <tr><td>Global Rank</td><td>{{ output.rank if output.rank is defined else "150" }}</td></tr>
            <tr><td>HTTP Status Code</td><td>{{ output.response_status if output.response_status is defined else "200" }}</td></tr>
            <tr><td>Domain Age</td><td>{{ output.age if output.age is defined else "2 ys" }}</td></tr>
            <tr><td>SSL/TLS</td>
                <td>{% if output.ssl and output.ssl != 0 %}Valid{% else %}Invalid{% endif %}</td>
            </tr>
        </table>

        <!-- Info for Nerds -->
        <div class="trusturl-sectionbox strong-bounded-box">
            <div class="trusturl-sectiontitle">Info for Nerds</div>
            <div class="scroll-table-wrap">
                <table class="table-view strong-bounded-table">
                    <tbody>
                        <tr><td>Global Rank</td><td>{{output.rank}}</td></tr>
                        <tr><td>HTTP Status Code</td><td>{{output.response_status}}</td></tr>
                        <tr><td>Domain Age</td><td>{{output.age}}</td></tr>
                        <tr><td>Use of URL Shortener</td><td>{% if output.is_url_shortened == 1 %}YES{% else %}NO{% endif %}</td></tr>
                        <tr><td>HSTS Support</td><td>{% if output.hsts_support == 1 %}YES{% else %}NO{% endif %}</td></tr>
                        <tr><td>IP instead of Domain</td><td>{% if output.ip_present == 1 %}YES{% else %}NO{% endif %}</td></tr>
                        <tr>
                            <td>URL Redirects</td>
                            <td>
                                {% if output.url_redirects == 0 %}
                                    NO
                                {% else %}
                                    {% for value in output.url_redirects %}{{ value }} {% endfor %}
                                {% endif %}
                            </td>
                        </tr>
                        <tr><td>IP of Domain</td><td>{{output.ip}}</td></tr>
                        <tr><td>Too Long URL</td><td>{% if output.too_long_url == 1 %}YES{% else %}NO{% endif %}</td></tr>
                        <tr><td>Too Deep URL</td><td>{% if output.too_deep_url == 1 %}YES{% else %}NO{% endif %}</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        {% if output.ssl and output.ssl != 0 %}
        <!-- SSL Certificate Details -->
        <div class="trusturl-sectionbox strong-bounded-box">
            <div class="trusturl-sectiontitle">SSL Certificate Details</div>
            <div class="scroll-table-wrap">
                <table class="table-view strong-bounded-table">
                    <tbody>
                        {% for key, value in output.ssl.items() %}
                        <tr>
                            <td>{{ key }}</td>
                            <td>{{ value }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %}

        {% if output.whois %}
        <!-- WHOIS Data -->
        <div class="trusturl-sectionbox strong-bounded-box">
            <div class="trusturl-sectiontitle">WHOIS Data</div>
            <div class="scroll-table-wrap">
                <table class="table-view strong-bounded-table">
                    <tbody>
                        {% for key, value in output.whois.items() %}
                        <tr>
                            <td>{{ key }}</td>
                            <td>
                                {% if value is string %}
                                    {{ value }}
                                {% elif value is mapping %}
                                    {{ value }}
                                {% elif value is iterable and value is not string %}
                                    {{ value | join(', ') }}
                                {% else %}
                                    {{ value }}
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %}

    </div>
    {% else %}
    <div class="trusturl-results">
        <p>No results to display. Please enter a URL above to check.</p>
    </div>
    {% endif %}
</div>
{% endblock %}
